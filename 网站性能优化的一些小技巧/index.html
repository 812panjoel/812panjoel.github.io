<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>网站性能优化的一些小技巧 | Panjoel's Blog</title><noscript>开启JavaScript才能访问本站哦~</noscript><link rel="icon" href="/img/pwa/favicon.ico"><link rel="stylesheet" href="/css/index.css?v=1.11.2"><link rel="stylesheet" href="https://cdn2.codesign.qq.com/icons/7pOrz0WXB5ZWJPX/latest/iconfont.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css"><meta name="description" content="关于网站性能优化的一些小技巧，更好地对页面进行性能优化"><meta name="apple-mobile-web-app-capable" content="Panjoel's Blog"><meta name="theme-color" content="var(--efu-main)"><meta name="apple-mobile-web-app-status-bar-style" content="var(--efu-main)"><link rel="bookmark" href="/img/pwa/favicon.ico"><link rel="apple-touch-icon" href="/img/pwa/favicon.ico" sizes="180x180"><script>console.log(
    "%c Program: Hexo %c Theme: Solitude %c Version: v1.11.2",
    "border-radius:5px 0 0 5px;padding: 5px 10px;color:white;background:#ff3842;",
    "padding: 5px 10px;color:white;background:#3e9f50;",
    "padding: 5px 10px;color:white;background:#0084ff;border-radius:0 5px 5px 0",
)</script><script>let mdate = "7-8,9-18,12-13";
mdate = (mdate.split(","));
let ndate = new Date();
for (let i of mdate) {
    if (i == (ndate.getMonth()+1) + "-" + (ndate.getDate())) {
        document.documentElement.classList.add('memorial');
    }
}</script><script>(()=>{
        const saveToLocal = {
            set: function setWithExpiry(key, value, ttl) {
                if (ttl === 0)
                    return
                const now = new Date()
                const expiryDay = ttl * 86400000
                const item = {
                    value: value,
                    expiry: now.getTime() + expiryDay
                }
                localStorage.setItem(key, JSON.stringify(item))
            },
            get: function getWithExpiry(key) {
                const itemStr = localStorage.getItem(key)
    
                if (!itemStr) {
                    return undefined
                }
                const item = JSON.parse(itemStr)
                const now = new Date()
    
                if (now.getTime() > item.expiry) {
                    localStorage.removeItem(key)
                    return undefined
                }
                return item.value
            }
        };
        window.utils = {
            saveToLocal: saveToLocal,
            getCSS: (url, id = false) => new Promise((resolve, reject) => {
              const link = document.createElement('link')
              link.rel = 'stylesheet'
              link.href = url
              if (id) link.id = id
              link.onerror = reject
              link.onload = link.onreadystatechange = function() {
                const loadState = this.readyState
                if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
                link.onload = link.onreadystatechange = null
                resolve()
              }
              document.head.appendChild(link)
            }),
            getScript: (url, attr = {}) => new Promise((resolve, reject) => {
              const script = document.createElement('script')
              script.src = url
              script.async = true
              script.onerror = reject
              script.onload = script.onreadystatechange = function() {
                const loadState = this.readyState
                if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
                script.onload = script.onreadystatechange = null
                resolve()
              }
    
              Object.keys(attr).forEach(key => {
                script.setAttribute(key, attr[key])
              })
    
              document.head.appendChild(script)
            }),
            addGlobalFn: (key, fn, name = false, parent = window) => {
                const globalFn = parent.globalFn || {}
                const keyObj = globalFn[key] || {}
        
                if (name && keyObj[name]) return
        
                name = name || Object.keys(keyObj).length
                keyObj[name] = fn
                globalFn[key] = keyObj
                parent.globalFn = globalFn
            },
        }
    })()</script><script>const GLOBAL_CONFIG = {
    root: '/',
    algolia: undefined,
    localsearch: undefined,
    runtime: '2019-04-01 00:00:00',
    lazyload: {
        enable: true,
        error: '/img/error_load.webp'
    },
    copyright: {"limit":50,"author":"作者: Panjoel","link":"链接: ","source":"来源: Panjoel's Blog","info":"著作权归作者所有。 商业转载请联系作者获得授权，非商业转载请注明出处。"},
    highlight: {
        enable: true,
        limit: 200,
        expand: true,
        copy: true,
        syntax: 'highlight.js'
    },
    randomlink: false,
    lang: {"theme":{"dark":"已切换至深色模式","light":"已切换至浅色模式"},"copy":{"success":"复制成功","error":"复制失败"},"backtop":"返回顶部","time":{"day":"天前","hour":"小时前","just":"刚刚","min":"分钟前","month":"个月前"},"f12":"开发者模式已打开，请遵循GPL协议。","totalk":"无需删除空行，直接输入评论即可","barrage":{"title":"热评"}},
    aside: {
        sayhello: {
            morning: '一日之计在于晨',
            noon: '吃饱了才有力气干活',
            afternoon: '集中精力，攻克难关',
            night: '不要太劳累了，早睡更健康',
            goodnight: '睡个好觉，保证精力充沛',
        },
        sayhello2: [],
        sayhello3: {
            prefix: '好久不见，',
            back: '欢迎再次回来，',
        },
    },
    covercolor: {
        enable: true
    },
    comment: {"avatar":"https://cravatar.cn","commentBarrage":true},
    lightbox: 'null',
    post_ai: false,
    right_menu: {"mode":{"dark":"深色模式","light":"浅色模式"},"img_error":"此图片无法复制与下载","music":{"start":"播放音乐","stop":"暂停音乐"},"barrage":{"open":"显示热评","close":"关闭热评"}},
};</script><script id="config-diff">var PAGE_CONFIG={is_post:!0,is_page:!1,is_home:!1,page:"",toc:!0,comment:!0,ai_text:!1}</script><meta name="generator" content="Hexo 7.2.0"></head><body id="body"><canvas id="universe"></canvas><div id="console"><div class="close-btn" onclick="sco.hideConsole()"><i class="solitude st-close-fill"></i></div><div class="console-card-group"><div class="console-card-group-right"><div class="console-card tags" onclick="sco.hideConsole()"><div class="card-content"><div class="author-content-item-tips">标签</div><div class="author-content-item-title">寻找感兴趣的领域</div></div><div class="card-tag-cloud"><a href="/tags/math/">math<sup>26</sup></a><a href="/tags/c/">c++<sup>9</sup></a><a href="/tags/tools/">tools<sup>1</sup></a><a href="/tags/python/">python<sup>15</sup></a><a href="/tags/geogebra/">geogebra<sup>3</sup></a><a href="/tags/hexo/">hexo<sup>1</sup></a></div></div><div class="console-card history" onclick="sco.hideConsole()"><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">2024/06</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span class="card-archive-list-count-unit">篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/06/"><span class="card-archive-list-date">2023/06</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span class="card-archive-list-count-unit">篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/01/"><span class="card-archive-list-date">2023/01</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span class="card-archive-list-count-unit">篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/12/"><span class="card-archive-list-date">2022/12</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span class="card-archive-list-count-unit">篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/09/"><span class="card-archive-list-date">2022/09</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span class="card-archive-list-count-unit">篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/08/"><span class="card-archive-list-date">2022/08</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span class="card-archive-list-count-unit">篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/07/"><span class="card-archive-list-date">2022/07</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span class="card-archive-list-count-unit">篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/06/"><span class="card-archive-list-date">2022/06</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span class="card-archive-list-count-unit">篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/05/"><span class="card-archive-list-date">2022/05</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">25</span><span class="card-archive-list-count-unit">篇</span></div></a></li></ul></div></div></div><div class="button-group"><div class="console-btn-item"><span class="darkmode_switchbutton" onclick="sco.switchDarkMode()" title="昼夜切换"><i class="solitude st-moon-clear-fill"></i></span></div><div class="console-btn-item" id="consoleHideAside"><span class="asideSwitch" onclick="sco.switchHideAside()" title="边栏显示控制"><i class="solitude st-side-bar-fill"></i></span></div><div class="console-btn-item" id="consoleKeyboard" onclick="sco.switchKeyboard()"><span class="keyboardSwitch" title="键盘快捷键"><i class="solitude st-keyboard-box-fill"></i></span></div><div class="console-btn-item" id="consoleMusic" onclick="sco.musicToggle()"><span class="music-switch" title="音乐开关"><i class="solitude st-disc-fill"></i></span></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="sco.switchCommentBarrage()"><span class="commentBarrage"><i class="solitude st-chat-fill"></i></span></div></div><div class="console-mask" onclick="sco.hideConsole()"></div></div><div id="sidebar" style="zoom:1"><div id="menu-mask" style="display:none"></div><div id="sidebar-menus"><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">47</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a></div></div></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><span class="darkmode_switchbutton menu-child" onclick="sco.switchDarkMode()"><i class="solitude st-moon-clear-fill"></i><span>显示模式</span></span></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://panjoel.github.io/" title="Github"><img class="nolazyload back-menu-item-icon" src="/img/pwa/favicon.ico" alt="Github"><span class="back-menu-item-text">Github</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://panjoel.pages.dev/" title="Cloudflare"><img class="nolazyload back-menu-item-icon" src="/img/pwa/favicon.ico" alt="Cloudflare"><span class="back-menu-item-text">Cloudflare</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://panjoel.netlify.app/" title="Netlify"><img class="nolazyload back-menu-item-icon" src="/img/pwa/favicon.ico" alt="Netlify"><span class="back-menu-item-text">Netlify</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>文库</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="solitude st-folder-fill"></i><span>文章列表</span></a></li><li><a class="site-page child" href="/categories/"><i class="solitude st-checkbox-multiple-blank-fill"></i><span>全部分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="solitude st-price-tag-fill"></i><span>全部标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>友链</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/moments/"><i class="solitude st-wifi-fill"></i><span>友链鱼塘</span></a></li><li><a class="site-page child" href="/links/"><i class="solitude st-group-fill"></i><span>友情链接</span></a></li><li><a class="site-page child" href="javascript:travelling()"><i class="solitude st-gift-fill"></i><span>宝藏博主</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>我的</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/equipment/"><i class="solitude st-laptop-line"></i><span>装备</span></a></li><li><a class="site-page child" href="/tlink/"><i class="solitude st-tools-fill"></i><span>工具箱</span></a></li><li><a class="site-page child" href="/music/"><i class="solitude st-disc-fill"></i><span>音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>关于</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="solitude st-contacts-fill"></i><span>关于本站</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-widget card-tags card-archives card-webinfo card-allinfo"><div class="card-tag-cloud"><a href="/tags/math/">math<sup>26</sup></a><a href="/tags/c/">c++<sup>9</sup></a><a href="/tags/tools/">tools<sup>1</sup></a><a href="/tags/python/">python<sup>15</sup></a><a href="/tags/geogebra/">geogebra<sup>3</sup></a><a href="/tags/hexo/">hexo<sup>1</sup></a></div></div></div></div><div id="keyboard-tips"><div class="keyboardTitle">博客快捷键</div><div class="keyboardList"><div class="keyboardItem"><div class="keyGroup"><div class="key">Shift</div><div class="key">K</div></div><div class="keyContent"><div class="content">关闭快捷键功能</div></div></div><div class="keyboardItem"><div class="keyGroup"><div class="key">Shift</div><div class="key">A</div></div><div class="keyContent"><div class="content">打开中控台</div></div></div><div class="keyboardItem"><div class="keyGroup"><div class="key">Shift</div><div class="key">M</div></div><div class="keyContent"><div class="content">播放/暂停音乐</div></div></div><div class="keyboardItem"><div class="keyGroup"><div class="key">Shift</div><div class="key">L</div></div><div class="keyContent"><div class="content">打开友情链接</div></div></div></div></div><script>const keyboard_addKeyup = (e) => {
    if (e.key === 'Shift') {
        document.getElementById('keyboard-tips').classList.remove('show');
    }
}

const keyboard_addKeydown = (e) => {
    const keyboards = [{"name":"关闭快捷键功能","key":"K","func":"keyboard"},{"name":"打开中控台","key":"A","sco":"showConsole"},{"name":"播放/暂停音乐","key":"M","sco":"musicToggle"},{"name":"打开友情链接","key":"L","url":"/links/"}];
    if (e.keyCode === 16) {
        document.getElementById('keyboard-tips').classList.add('show');
    }

    for (let i = 0; i < keyboards.length; i++) {
        if (keyboards[i].url) {
            if (keyboards[i].url.startsWith('http')) {
                if (e.key === keyboards[i].key) {
                    window.open(keyboards[i].url);
                }
            } else {
                if (e.key === keyboards[i].key) {
                    pjax.loadUrl(keyboards[i].url);
                }
            }
        } else if (keyboards[i].sco) {
            if (e.key === keyboards[i].key) {
                sco[keyboards[i].sco]();
            }
        } else if (keyboards[i].func) {
            if (e.key === keyboards[i].key) {
                window[keyboards[i].func]();
            }
        }
    }
}

function openKeyboard() {

    window.addEventListener('keyup', keyboard_addKeyup);

    window.addEventListener('keydown', keyboard_addKeydown);
}
function closeKeyboard() {

    window.removeEventListener('keyup', keyboard_addKeyup);

    window.removeEventListener('keydown', keyboard_addKeydown);
}

var sco_keyboards = localStorage.getItem('keyboard') === 'true'
if (sco_keyboards) {
    openKeyboard();
    document.getElementById('consoleKeyboard').classList.add('on');
}</script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav class="show" id="nav"><div id="nav-group"><div id="blog_name"><div class="back-home-button" tabindex="-1"><i class="back-home-button-icon solitude st-more-fill"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://panjoel.github.io/" title="Github"><img class="nolazyload back-menu-item-icon" src="/img/pwa/favicon.ico" alt="Github"><span class="back-menu-item-text">Github</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://panjoel.pages.dev/" title="Cloudflare"><img class="nolazyload back-menu-item-icon" src="/img/pwa/favicon.ico" alt="Cloudflare"><span class="back-menu-item-text">Cloudflare</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://panjoel.netlify.app/" title="Netlify"><img class="nolazyload back-menu-item-icon" src="/img/pwa/favicon.ico" alt="Netlify"><span class="back-menu-item-text">Netlify</span></a></div></div></div></div><a id="site-name" href="/" title="返回博客主页"><span class="title">Panjoel</span></a></div><div id="page-name-mask"><div id="page-name"><a id="page-name-text" onclick="sco.toTop()">网站性能优化的一些小技巧</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>文库</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="solitude st-folder-fill"></i><span>文章列表</span></a></li><li><a class="site-page child" href="/categories/"><i class="solitude st-checkbox-multiple-blank-fill"></i><span>全部分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="solitude st-price-tag-fill"></i><span>全部标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>友链</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/moments/"><i class="solitude st-wifi-fill"></i><span>友链鱼塘</span></a></li><li><a class="site-page child" href="/links/"><i class="solitude st-group-fill"></i><span>友情链接</span></a></li><li><a class="site-page child" href="javascript:travelling()"><i class="solitude st-gift-fill"></i><span>宝藏博主</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>我的</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/equipment/"><i class="solitude st-laptop-line"></i><span>装备</span></a></li><li><a class="site-page child" href="/tlink/"><i class="solitude st-tools-fill"></i><span>工具箱</span></a></li><li><a class="site-page child" href="/music/"><i class="solitude st-disc-fill"></i><span>音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>关于</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="solitude st-contacts-fill"></i><span>关于本站</span></a></li></ul></div></div></div><div id="nav-left"></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机一篇文章" href="javascript:void(0);"><i class="solitude st-dice-line"></i></a></div><div class="nav-button" id="nav-console"><a class="console_switchbutton" onclick="sco.showConsole()" title="中控台" href="javascript:void(0);"><i class="solitude st-dashboard-fill"></i></a></div><div class="nav-button" id="nav-totop" onclick="sco.toTop()"><a class="totopbtn"><i class="solitude st-arrow-up-line"></i><span id="percent">0</span></a></div><div id="toggle-menu"><a class="site-page"><i class="solitude st-menu-line"></i></a></div></div></div></nav><div class="coverdiv" id="coverdiv"><img class="nolazyload" id="post-cover" src="https://s1.ax1x.com/2023/01/06/pSATc6O.png" alt="网站性能优化的一些小技巧"></div><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original" title="该文章为原创文章，注意版权协议">原创</a><span class="post-meta-categories"><a class="post-meta-categories" href="/categories/PFS%E3%81%AE%E7%BE%8E%E5%8C%96/">PFSの美化</a></span><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/hexo/"><span class="tags-name tags-punctuation">hexo</span></a></div></div></div></div><h1 class="post-title">网站性能优化的一些小技巧</h1><div id="post-meta"><div class="meta-secondline"><span class="post-meta-date" title="发布于 2022-12-29 20:52:20"><i class="post-meta-icon solitude st-calendar-todo-fill"></i><time datetime="2022-12-29T12:52:20.000Z">2022-12-29T12:52:20.000Z</time></span><span class="post-meta-position" title="作者IP归属地为杭州"><i class="post-meta-icon solitude st-map-pin-fill"></i><span>杭州</span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>本文内容参考自：<a target="_blank" rel="noopener" href="https://www.fomal.cc/">Fomalhaut</a>的<a target="_blank" rel="noopener" href="https://www.fomal.cc/posts/b48804d5.html/">网站性能优化的一些小技巧</a>，如果仅仅想进行优化不想花费太多时间了解原理可以直接跳到第二部分</p><h1>理论部分</h1><h2 id="浏览器渲染原理"><a class="headerlink" href="#浏览器渲染原理"></a>浏览器渲染原理</h2><p>我们需要知道浏览器是如何渲染一个页面的，我们才能知道如何对页面进行性能优化，所以这里我们对一些基础知识进行讲解。</p><h3 id="进程与线程"><a class="headerlink" href="#进程与线程"></a>进程与线程</h3><p>浏览器有多种进程，其中最主要的5种进程如下：</p><p><img src="https://bu.dusays.com/2022/05/23/628b96c2e0bec.webp" alt="p1" loading="lazy"></p><ol><li>浏览器进程 负责界面展示、用户交互、子进程管理、提供存储等</li><li>渲染进程 每个页面都有一个单独的渲染进程，用于渲染页面，包含webworker线程</li><li>网络进程 主要处理网络资源加载（HTML、CSS、JS、IMAGE、AJAX等）</li><li>GPU进程 3D绘制，提高性能</li><li>插件进程 chrome插件，每个插件占用一个进程</li></ol><h3 id="输入url到页面展示完整过程"><a class="headerlink" href="#输入url到页面展示完整过程"></a>输入url到页面展示完整过程</h3><p><img src="https://bu.dusays.com/2022/05/23/628b9dcaedcbd.jpg" alt="p2" loading="lazy"></p><p><strong>用户输入</strong></p><p>用户在浏览器进程输入并按下回车健后，浏览器判断用户输入的url是否为正确的url，如果不是，则使用默认的搜索引擎将该关键字拼接成url。</p><p><strong>卸载原页面并重定向到新页面</strong></p><p>然后浏览器会将现有页面卸载掉并重定向到用户新输入的url页面，也就是图中【Process Unload Event】和【Redirect】流程。</p><p>此时浏览器会准备一个渲染进程用于渲染即将到来的页面，和一个网络进程用于发送网络请求。</p><p><strong>处理Service Worker</strong></p><p>如果当前页面注册了Service Worker那么它可以拦截当前网站所有的请求，进行判断是否需要向远程发送网络请求。也就是图中【Service Worker Init】与【Service Worker Fecth Event 】步骤</p><p>如果不需要发送网络请求，则取本地文件。如果需要则进行下一步。</p><p><strong>网络请求</strong></p><p><img src="https://bu.dusays.com/2022/05/23/628b99a83152f.webp" alt="p3" loading="lazy"></p><ol><li>根据url查询本地是否已经有强制缓存，如果有则判断缓存是否过期，如果没过期则直接返回缓存内容，也就是图1中【HTTP Cache】步骤</li><li>如果没有强制缓存或者缓存已过期，则将该请求加入队列进行排队准备发送网络请求，也就是图2中【正在排队】，然后进入DNS解析阶段，也就是图1中【DNS】以及图2中的【DNS查找】，DNS根据域名解析出对应的IP地址。(DNS基于UDP)。</li><li>使用IP寻址找到对方，然后根据IP地址+端口号创建一个TCP连接(三次握手)，也就是图1中【TCP】以及图2中的【初始连接】创建完成后利用TCP连接来传输数据。(TCP会将数据拆分为多个数据包，进行有序传输，如果丢包会重发，TCP的特点是可靠、有序)</li><li>判断当前协议是否为https，如果为https，则进行SSL协商，将数据进行加密，如果为http协议则不进行加密(明文传输)，也就是图2中的【SSL】。</li><li>开始发送http请求(请求行/请求头/请求体)，也就是图1中【Request】以及图2中的【已发送请求】。HTTP协议有多个版本，目前使用最多的版本为HTTP/1.1，HTTP/1.1发送完成后默认不会断开。keep-alive 默认打开，为了下次传输数据时复用上次创建的连接。每个域名最多同时建立6个TCP连接，所以同一时间最多发生6个请求。</li><li>服务器收到数据后解析HTTP请求(请求行/请求头/请求体)，处理完成后生成状态码和HTTP响应(响应行/响应头/响应体)后返回给客户端，也就是图2的【等待中】在做的事情。</li><li>客户端接收到HTTP响应后根据状态码进行对应的处理，如果状态码为304则直接代表协商缓存生效，直接取本地的缓存文件。如果不是则下载内容。也就是图1中【Response】以及图2中的【下载内容】步骤。</li></ol><p><strong>服务端响应</strong></p><p>在网络请求第6步中，服务器收到HTTP请求后需要根据请求信息来进行解析，并返回给客户端想要的数据，这也就服务端响应。</p><p>服务端可以响应并返回给客户端很多种类型的资源，这里主要介绍html类型。</p><p>目前前端处理服务端响应html请求主要分为SSR服务端渲染与CSR客户端渲染，CSR就是返回一个空的HTML模版，然后浏览器加载js后通过js动态渲染页面。SSR是服务端在接受到请求时事先在服务端渲染好html返回给客户端后，客户端再进行客户端激活。</p><p>在打开一个站点的首屏页的完整链路中，使用SSR服务端渲染时的速度要远大于CSR客户端渲染，并且SSR对SEO友好。所以对于首屏加载速度比较敏感或者需要优化SEO的站点来说，使用SSR是更好的选择。</p><p><strong>浏览器渲染详细流程</strong></p><p>浏览器渲染详细流程主要在网络请求中的地7步。浏览器下载完html内容后进行解析何渲染页面的流程。</p><p><img src="https://bu.dusays.com/2022/05/23/628ba7881b1a8.webp" alt="p4" loading="lazy"><br>渲染流程分为4种情况：</p><ol><li>HTML中无任何CSS相关标签</li><li>CSS相关标签在HTML最顶部，且在解析到内容标签<code>（&lt;div /&gt;）</code>时已经解析完CSS相关标签</li><li>CSS相关标签在HTML最顶部，但在解析到内容标签<code>（&lt;div /&gt;）</code>时CSS相关标签尚未解析完</li><li>CSS相关标签在HTML最底部<br>（略）</li></ol><h3 id="浏览器处理每一帧的流程"><a class="headerlink" href="#浏览器处理每一帧的流程"></a>浏览器处理每一帧的流程</h3><p>浏览器在渲染完页面之后还需要不间断的处理很多内容的，比如动画、用户事件、定时器等。因此当浏览器渲染完页面后，还会在之后的每一帧到来时执行以下的流程。</p><p><img src="https://bu.dusays.com/2022/05/24/628bb016bb39b.webp" alt="p5" loading="lazy"></p><ol><li>【Input events】处理用户事件，先处理【阻塞事件Blocking】包括touch和wheel事件，后处理【非阻塞事件Non-blocking】包括click和keypress。</li><li>【JS】处理完用户事件后执行【定时器Timers】</li><li>【Begin frame】处理完定时器后开始进行【每帧事件Per frame events】的处理，包括窗口大小改变、滚动、媒体查询的更改、动画事件。</li><li>【rAF】处理完帧事件后执行requestAnimationFrame回调函数和IntersectionObserver回调函数。</li><li>【Layout】然后【重新计算样式Recalc style】、【更新布局Update layout】、【调整Observer回调的大小Resize Observer callbacks】</li><li>【Paint】然后【合成更新Compositing update】、【Paint invalidation】、【Record】</li></ol><h2 id="Chrome性能优化相关工具"><a class="headerlink" href="#Chrome性能优化相关工具"></a>Chrome性能优化相关工具</h2><p>了解完浏览器渲染原理，我们还需要知道根据哪些指标才能判断一个页面性能的好坏，在Chrome中这些指标应该怎么获取。以及Chrome都为我们提供了哪些性能相关的工具，如何使用。</p><h3 id="Chrome-Performance-性能"><a class="headerlink" href="#Chrome-Performance-性能"></a>Chrome Performance(性能)</h3><p>Performance既是一个Chrome工具，可用于性能检测。<br>同样又是一套JS API，可在Chrome中执行。</p><p><strong>Chrome</strong> Performance 工具的使用</p><p>打开Chrome调试面板选择Performance，中文版为性能，点击刷新按钮，Performance会刷新并录制当前页面，然后我们就可以在面板中看到如下的各种性能相关细节。<br><img src="https://bu.dusays.com/2022/05/24/628bb12aad445.webp" alt="p6" loading="lazy"></p><p><strong>使用Performance API获取性能相关指标</strong></p><p>接下来我们来了解一下目前常用的性能指标，并且我们需要知道其中一些关键指标如何用Performance API获取。</p><ol><li>TTFB（Time To First Byte）首字节时间：从发送请求到数据返回第一个字节所消耗的时间。</li><li>FP (First Paint) 首次绘制: 第一个像素绘制到页面上的时间。</li><li>FCP (First Contentful Paint) 首次内容绘制: 标记浏览器渲染来自 DOM 第一位内容的时间点，该内容可能是文本、图像、SVG 甚至 元素。</li><li>FMP(First Meaningful Paint) 首次有效绘制: 例如，在 YouTube 观看页面上，主视频就是主角元素。<br>图片可以没加载完成，但整体的骨架已经加载完成了。<br>1秒内完成FMP的概率超过80%，那就代表这个网站是一个性能较好的网站。</li><li>TTI (Time to Interactive) 可交互时间 : DOM树构建完毕，可以绑定事件的时间</li><li>LCP (Largest Contentful Paint) 最大内容渲染: 代表在viewport中最大的页面元素加载的时间。LCP的数据会通过PerformanceEntry对象记录, 每次出现更大的内容渲染, 则会产生一个新的PerformanceEntry对象(2019年11月新增)。</li><li>DCL (DomContentloaded): 当 HTML 文档被完全加载和解析完成之后，DOMContentLoaded 事件被触发，无需等待样式表、图像和子框架的完成加载。</li><li>L (onLoad), 当依赖的资源(图片、文件等), 全部加载完毕之后才会触发。</li><li>L (onLoad), 当依赖的资源(图片、文件等), 全部加载完毕之后才会触发。</li><li>TBT (Total Blocking Time) 页面阻塞总时长: TBT汇总所有加载过程中阻塞用户操作的时长，在FCP和TTI之间任何long task中阻塞部分都会被汇总。</li><li>CLS (Cumulative Layout Shift) 累积布局偏移: 总结起来就是一个元素初始时和其hidden之间的任何时间如果元素偏移了, 则会被计算进去, 具体的计算方法可看这篇文章 <a target="_blank" rel="noopener" href="https://web.dev/cls/">https://web.dev/cls/</a></li><li>SI (Speed Index): 指标用于显示页面可见部分的显示速度, 单位是时间。</li></ol><h3 id="Coverage-覆盖率"><a class="headerlink" href="#Coverage-覆盖率"></a>Coverage(覆盖率)</h3><p>获取代码未使用占比。获取代码未使用占比<br><img src="https://bu.dusays.com/2022/05/24/628bb981db5c8.webp" alt="p7" loading="lazy"></p><h3 id="Lighthouse"><a class="headerlink" href="#Lighthouse"></a>Lighthouse</h3><p>获取性能报告并查看推荐优化项。可以在本地安装命令行工具来使用，也可以通过Chrome来使用。<br><img src="https://bu.dusays.com/2022/05/24/628cf77e139ff.webp" alt="p8" loading="lazy"></p><h3 id="Network-网络"><a class="headerlink" href="#Network-网络"></a>Network(网络)</h3><p><strong>网络请求中的Timing(时间)</strong></p><p>能获取网络请求的时间消耗细节，可以根据耗时来决定优化策略。优先优化耗时最长的。<br><img src="https://bu.dusays.com/2022/05/24/628cf966b69da.webp" alt="p9" loading="lazy"></p><ul><li>正在排队：网络请求队列的排队时间</li><li>已停止：阻塞住用于处理其他事情的时间</li><li>DNS查找：用于DNS解析IP地址的时间</li><li>初始连接：创建TCP连接时间</li><li>SSL：用于SSL协商的时间</li><li>已发送请求：用于发送请求的时间</li><li>等待中：请求发出至接收响应的时间也可以理解为服务端处理请求的时间</li><li>下载内容：下载响应的时间</li></ul><p><strong>网络请求的优先级</strong></p><p>浏览器会根据资源的类型决定优先请求哪些资源，优先级高的请求能够优先被加载。<br><a target="_blank" rel="noopener" href="https://bu.dusays.com/2022/05/24/628cf9efddd7f.webp"><img src="https://bu.dusays.com/2022/05/24/628cf9efddd7f.webp" alt="p10" loading="lazy"></a><br>不同资源类型的优先级排序如下：</p><ul><li>最高：html、style</li><li>高：font、fetch、script</li><li>低：image、track</li></ul><p><strong>网页总资源信息</strong></p><p><img src="https://bu.dusays.com/2022/05/24/628cfb20c1315.webp" alt="p11" loading="lazy"></p><ul><li>58个请求：网页一共多少个请求</li><li>6.9 MB 项资源：网页资源一共6.9MB大小</li><li>DOMContentLoaded 454 毫秒：DOM加载完毕的时长</li><li>加载时间 1.02 秒：onload完毕的时长</li></ul><p><strong>Network配置</strong></p><p><img src="https://bu.dusays.com/2022/05/24/628cfcbe97759.webp" alt="p12" loading="lazy"></p><h2 id="网页性能优化"><a class="headerlink" href="#网页性能优化"></a>网页性能优化</h2><p>上面我们分别讲解了进程与线程、浏览器打开一个页面的完整过程、浏览器处理每一帧时的流程、Chrome性能相关的各种工具以及性能相关的各种指标。以上内容都掌握之后我们再考虑性能优化遍有了思路，我们在页面展示的任意一个步骤中对其进行优化都能对整个网页的展示性能产生影响。</p><p>下面列出了一个页面能优化的所有内容，读者可根据自己的业务情况结合性能工具来做适合自己的优化方式。</p><h3 id="网络优化策略"><a class="headerlink" href="#网络优化策略"></a>网络优化策略</h3><p><strong>减少HTTP请求数</strong></p><p>合并JS、合并CSS、合理内嵌JS和CSS、使用雪碧图。</p><p><strong>使用HTTP缓存</strong></p><p>使用强制缓存可以不走网络请求，直接走本地缓存数据来加载资源。</p><p>使用协商缓存可以减少数据传输，当不需要更新数据时可通知客户端直接使用本地缓存。</p><p><strong>使用 HTTP/2.0</strong></p><p>HTTP/2.0使用同一个TCP连接来发送数据，他把多个请求通过二进制分贞层实现了分贞，然后把数据传输给服务器。也叫多路复用，多个请求复用同一个TCP连接。</p><p>HTTP/2.0会将所有以:开头的请求头做一个映射表，然后使用hpack进行压缩，使用这种方式会使请求头更小。</p><p>服务器可主动推送数据给客户端。</p><p><strong>避免重定向</strong></p><p>301、302 重定向会降低响应速度。</p><p><strong>使用 dns-prefetch</strong></p><p>DNS请求虽然占用的带宽较少，但会有很高的延迟，由其在移动端网络会更加明显。</p><p>使用 dns-prefetch 可以对网站中使用到的域名提前进行解析。提高资源加载速度。</p><p>通过DNS预解析技术可以很好的降低延迟，在访问以图片为主的移动端网站时，使用DNS预解析的情意中下页面加载时间可以减少5%。</p><p><strong>使用域名分片</strong></p><p>在HTTP/1.1中，一个域名同时最多创建6个TCP连接，将资源放在多个域名下可提高请求的并发数。</p><p><strong>CDN</strong></p><p>静态资源全上CDN，CDN能非常有效的加快网站静态资源的访问速度。</p><p><strong>压缩</strong></p><p>gzip压缩、html压缩、js压缩、css压缩、图片压缩。</p><p><strong>使用contenthash</strong></p><p>contenthash可以根据文件内容在文件名中加hash，可用于浏览器缓存文件，当文件没有改变时便直接取本地缓存数据。</p><p><strong>合理使用preload、prefetch</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;preload&quot;</span> <span class="attr">as</span>=<span class="string">&quot;style&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/static/style.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;preload&quot;</span> <span class="attr">as</span>=<span class="string">&quot;font&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/static/font.woff&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;preload&quot;</span> <span class="attr">as</span>=<span class="string">&quot;script&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/static/script.js&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;prefetch&quot;</span> <span class="attr">as</span>=<span class="string">&quot;style&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/static/style.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;prefetch&quot;</span> <span class="attr">as</span>=<span class="string">&quot;font&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/static/font.woff&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;prefetch&quot;</span> <span class="attr">as</span>=<span class="string">&quot;script&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/static/script.js&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>两者都不会阻塞<code>onload</code>事件，<code>prefetch</code>会在页面空闲时候再进行加载，是提前预加载之后可能要用到的资源，不一定是当前页面使用的，<code>preload</code>预加载的是当前页面的资源。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;preload&quot;</span> <span class="attr">as</span>=<span class="string">&quot;style&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./preload.css&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">article</span>&gt;</span><span class="tag">&lt;/<span class="name">article</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如上代码，预加载了css但并没有使用。浏览器在页面<code>onload</code>完成一段时间后，发现还没有引用预加载的资源时，浏览器会在控制台输出下图的提示信息。<br><img src="https://bu.dusays.com/2022/05/24/628cfd2d0b279.webp" alt="p13" loading="lazy"></p><p>preload和prefetch可根据资源类型决定资源加载的优先级，详细优先级如代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 最高 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;preload&quot;</span> <span class="attr">as</span>=<span class="string">&quot;style&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./file.xxx&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 高 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;preload&quot;</span> <span class="attr">as</span>=<span class="string">&quot;font&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./file.xxx&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;preload&quot;</span> <span class="attr">as</span>=<span class="string">&quot;fetch&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./file.xxx&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;preload&quot;</span> <span class="attr">as</span>=<span class="string">&quot;script&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./file.xxx&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 低 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;preload&quot;</span> <span class="attr">as</span>=<span class="string">&quot;image&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./file.xxx&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;preload&quot;</span> <span class="attr">as</span>=<span class="string">&quot;track&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./file.xxx&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">article</span>&gt;</span><span class="tag">&lt;/<span class="name">article</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://bu.dusays.com/2022/05/24/628cfd767a1b3.webp"><img src="https://bu.dusays.com/2022/05/24/628cfd767a1b3.webp" alt="p14" loading="lazy"></a></p><h3 id="浏览器渲染优化策略"><a class="headerlink" href="#浏览器渲染优化策略"></a>浏览器渲染优化策略</h3><p><strong>关键渲染路径</strong></p><p>当通过JS或者其他任意方式修改DOM后，浏览器会进入如下流程。</p><p>【JS通过API修改DOM】&gt;【计算样式】&gt;【布局(重排)】&gt;【绘制(重绘)】&gt;【合成】。</p><p><code>Reflow 重排</code>：重排在Chrome Performance中叫做布局，通常添加或删除元素、修改元素大小、移动元素位置、获取位置信息都会触发页面的重排，因为重排可能会改变元素的大小位置等信息，这样的改变会影响到页面大量其它元素的大小位置信息，会耗费掉大量的性能，所以在实际应用中我们应该尽可能的减少重排。</p><p><code>Repaint 重绘</code>：重绘在Chrome Performance中叫做绘制，通常样式改变但没有影响位置时会触发重绘操作，重绘性能还好，但我们也需要尽量减少重绘，如果需要做一些动画，我们尽量使用CSS3动画，CSS3动画只需要在初始化时绘制一次，之后的动画都不会触发重绘操作。</p><p><strong>强制同步布局问题</strong></p><p>在同一个函数内，修改元素后又获取元素的位置时会触发强制同步布局，影响渲染性能。</p><p>强制同步布局会使js强制将【计算样式】和【布局(重排)】操作提前到当前函数任务中，这样会导致每次运行时执行一次【计算样式】和【重排】，这样一定会影响页面渲染性能，而正常情况下【计算样式】和【重排】操作会在函数结束后统一执行。</p><p><strong>如何减少重排与重绘</strong></p><ol><li>脱离文档流(绝对定位、固定定位)，脱离文档流的元素进行重排不会影响到其他元素。</li><li>图片渲染时增加宽高属性，宽高固定后，图片不会根据内容动态改变高度，便不会触发重排。</li><li>尽量用CSS3动画，CSS3动画能最大程度减少重排与重绘。</li><li>使用will-change: transform;将元素独立为一个单独的图层。（定位、透明、transform、clip都会产生独立图层）。</li></ol><h3 id="静态文件优化策略"><a class="headerlink" href="#静态文件优化策略"></a>静态文件优化策略</h3><p><strong>图片优化</strong></p><p>图片格式</p><ol><li><code>jpg(jpeg)</code>：适合色彩丰富的图、Banner图。不适合：图形文字、图标、不支持透明度。</li><li><code>png</code>：适合纯色、透明、图标，支持纯透明和半透明。不适合色彩丰富图片，因为无损储存会导致储存体积大于jpeg。</li><li><code>gif</code>：适合动画、可以动的图标。支持纯透明但不支持半透明，不适合色彩丰富的图片。埋点信息通常也会使用gif发送，因为1x1的gif图发送的网络请求比普通的get请求要小一些。</li><li><code>webp</code>：支持纯透明和半透明，可以保证图片质量和较小的体积，适合Chrome和移动端浏览器。不适合其他浏览器。</li><li><code>svg</code>：矢量格式，大小非常小，但渲染成本过高，适合小且色彩单一的图标。</li></ol><p>优化策略</p><ul><li>减少图片资源的尺寸和大小，节约用户流量。</li><li>设置<code>alt=”xxx”</code>属性，图像无法显示时会显示alt内容。</li><li>图片懒加载， <code>loading=”lazy”</code>为原生，建议使用<code>IntersectionObserver</code>自己做懒加载。</li><li>不同环境加载不同尺寸和像素的图片srcset与sizes的使用。</li><li>采用渐进式加载 先加载占位图，然后加载模糊小图，最后加载真正清晰的图。</li><li>使用Base64URL 减少图片请求数。</li><li>采用雪碧图合并图片，减少请求数。</li></ul><p><strong>HTML优化</strong></p><ul><li>语义化HTML，代码简洁清晰，利于SEO，便于开发维护。</li><li>减少HTML嵌套关系，减少DOM节点数量。</li><li>提前声明字符编码，让浏览器快速确定如何渲染网页内容<code>&lt;html lang=&quot;en&quot;&gt; &lt;meta charset=&quot;UTF-8&quot;&gt;</code>。</li><li>删除多余空格、空行、注释、无用属性。</li><li>减少iframe，子iframe会阻塞父级的onload事件。可以使用js动态给iframe赋值，就能解决这个问题。</li><li>避免table布局。</li></ul><p><strong>CSS优化</strong></p><ul><li>减少伪类选择器，减少选择器层数、减少通配符选择器、减少正则选择器。</li><li>避免css表达式<code>background-color: expression(...)</code>。</li><li>删除空格、空行、注释、减少无意义的单位、css压缩。</li><li>css外链，能走缓存。</li><li>添加媒体字段，只加载有效的css文件。</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./small.css&quot;</span> <span class="attr">media</span>=<span class="string">&quot;screen and (max-width:600px)&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./big.css&quot;</span> <span class="attr">media</span>=<span class="string">&quot;screen and (min-width:601px)&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><ul><li>使用<code>css contain</code>属性，能控制对应元素是否根据子集元素的改变进行重排。</li><li>减少<code>@import</code>使用，因为它使用串行加载。</li></ul><p><strong>JS优化</strong></p><ul><li>通过script的<code>async</code>、<code>defer</code>属性异步加载，不阻塞DOM渲染。</li><li>减少DOM操作，缓存访问过的元素。</li><li>不直接操作真实DOM，可以先修改，然后一次性应用到DOM上。（虚拟DOM、DOM碎片节点）。</li><li>使用webworker解决复杂运算，避免复杂运算阻塞主线程，webworker线程位于渲染进程。</li><li>图片懒加载，使用<code>IntersectionObserver</code>实现。</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-tag">img</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">display</span>: block;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./loading.gif&quot;</span> <span class="attr">data-src</span>=<span class="string">&quot;./01.jpg&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./loading.gif&quot;</span> <span class="attr">data-src</span>=<span class="string">&quot;./02.jpg&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./loading.gif&quot;</span> <span class="attr">data-src</span>=<span class="string">&quot;./03.jpg&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./loading.gif&quot;</span> <span class="attr">data-src</span>=<span class="string">&quot;./04.jpg&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./loading.gif&quot;</span> <span class="attr">data-src</span>=<span class="string">&quot;./05.jpg&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./loading.gif&quot;</span> <span class="attr">data-src</span>=<span class="string">&quot;./06.jpg&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./loading.gif&quot;</span> <span class="attr">data-src</span>=<span class="string">&quot;./07.jpg&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./loading.gif&quot;</span> <span class="attr">data-src</span>=<span class="string">&quot;./08.jpg&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./loading.gif&quot;</span> <span class="attr">data-src</span>=<span class="string">&quot;./09.jpg&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./loading.gif&quot;</span> <span class="attr">data-src</span>=<span class="string">&quot;./10.jpg&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> intersectionObserver = <span class="keyword">new</span> <span class="title class_">IntersectionObserver</span>(<span class="function">(<span class="params">changes</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        changes.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (item.<span class="property">intersectionRatio</span> &gt; <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            intersectionObserver.<span class="title function_">unobserve</span>(item.<span class="property">target</span>)</span></span><br><span class="line"><span class="language-javascript">            item.<span class="property">target</span>.<span class="property">src</span> = item.<span class="property">target</span>.<span class="property">dataset</span>.<span class="property">src</span></span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> domImgList = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;img&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">      domImgList.<span class="title function_">forEach</span>(<span class="function">(<span class="params">domImg</span>) =&gt;</span> intersectionObserver.<span class="title function_">observe</span>(domImg));</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>虚拟滚动</li><li>使用<code>requestAnimationFrame</code>来做动画，使用<code>requestIdleCallback</code>来进行空闲时的任务处理。</li><li>尽量避免使用eval，性能差。</li><li>使用事件委托，能减少事件绑定个数。事件越多性能越差。</li><li>尽量使用<code>canvas</code>、<code>css3</code>动画。</li><li>通过chrome覆盖率（Coverage）工具排查代码中未使用过的代码并将其删除。</li><li>通过chrome性能（Performance）工具查看每个函数的执行性能并优化。</li></ul><p><strong>字体优化</strong></p><p><code>FOUT</code>(Flash of Unstyled Text）等待一段时间，如果没加载完成，先显示默认。加载 后再进行切换。</p><p><code>FOIT</code>(F1ash of Invisib1e Text） 字体加载完毕后显示，加载超时降级系统字体（白屏）。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="keyword">@font-face</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">font-family</span>: <span class="string">&#x27;hagan&#x27;</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">&#x27;./font.ttc&#x27;</span>);</span></span><br><span class="line"><span class="language-css">      <span class="attribute">font-display</span>: swap;</span></span><br><span class="line"><span class="language-css">      <span class="comment">/* b1ock 35 内不显示，如果没加载完毕用默认的 */</span></span></span><br><span class="line"><span class="language-css">      <span class="comment">/* swap 显示老字体 在替换*/</span></span></span><br><span class="line"><span class="language-css">      <span class="comment">/* fa11back 缩短不显示时间，如果没加载完毕用默认的，和b1ock类似*</span></span></span><br><span class="line"><span class="comment"><span class="language-css">      /* optional 替换可能用字体 可能不替换*/</span></span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">article</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">font-family</span>: hagan;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">article</span>&gt;</span>ABC abc<span class="tag">&lt;/<span class="name">article</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="浏览器储存优化策略"><a class="headerlink" href="#浏览器储存优化策略"></a>浏览器储存优化策略</h3><p><strong>Cookie</strong></p><p><code>cookie</code>在过期之前一直有效，最大储存大小为4k，限制字段个数，不适合大量的数据储存，每次请求会携带<code>cookie</code>，主要用来做身份校验。<br>优化方式：</p><ol><li>需要合理设置cookie有效期。</li><li>根据不同子域划分cookie来减少cookie传输。</li><li>静态资源域名和cookie域名采用不同域名，避免静态资源请求携带cookie。</li></ol><p><strong>LocalStorage</strong></p><p>Chrome下最多储存5M，除非手动清除，否则一直存在。可以利用<code>localStorage</code>储存静态资源。比如储存网页的<code>.js</code>、<code>.css</code>，这样会使页面打开速度非常快。例如 <a target="_blank" rel="noopener" href="https://m.baidu.com">百度</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> name = <span class="string">&#x27;hagan&#x27;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showName</span> () &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(name)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">showName</span>()</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://lib.baomitu.com/axios/0.26.1/axios.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">cacheFile</span>(<span class="string">&#x27;/index.js&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">cacheFile</span> (url) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> fileContent = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(url)</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (fileContent) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="built_in">eval</span>(fileContent)</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> axios.<span class="title function_">get</span>(url)</span></span><br><span class="line"><span class="language-javascript">        <span class="built_in">eval</span>(data)</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(url, data)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="SessionStorage"><a class="headerlink" href="#SessionStorage"></a><strong>SessionStorage</strong></h4><p>会话级别储存，可用于页面间的传值。</p><p><strong>IndexDB</strong></p><p>浏览器的本地数据库，大小几乎无上限。</p><h3 id="其他优化策略"><a class="headerlink" href="#其他优化策略"></a>其他优化策略</h3><ul><li>关键资源个数越多，首次页面加载时间就会越长。</li><li>关键资源的大小，内容越小下载时间越短。</li><li>优化白屏，合理使用内联css、js。</li><li>预渲染，打包时进行预渲染，生成静态HTML文件，用户访问时直接返回静态HTML。</li><li>服务端渲染同构，加速首屏速度（耗费服务端资源），有利于SEO优化。首屏使用服务端渲染，后续交互使用客户端渲染。</li></ul><h3 id="使用PWA提高用户体验"><a class="headerlink" href="#使用PWA提高用户体验"></a>使用PWA提高用户体验</h3><p>webapp用户体验差的一大原因是不能离线访问。用户粘性低的一大原因是无法保存入口，PWA就是为了解决webapp的用户体验问题而诞生的。使用PWA能令站点拥有快速、可靠、安全等特性。</p><ol><li><code>Web App Manifest</code> 将网站添加到电脑桌面、手机桌面，类似Native的体验。</li><li><code>Service Worker</code> 配合<code>Cache API</code>，能做到离线缓存各种内容。</li><li><code>Push API</code> 配合 <code>Notification API</code>，能做到类似Native的消息推送与实时提醒。</li><li><code>App Shell</code> 配合 <code>App Skeleton</code>，能做App壳与骨架屏。</li></ol><h1>优化小技巧实操</h1><h2 id="图片压缩"><a class="headerlink" href="#图片压缩"></a>图片压缩</h2><h3 id="图片多级压缩"><a class="headerlink" href="#图片多级压缩"></a>图片多级压缩</h3><p>目前从网上下载的图片主流格式是<code>JPG</code>或者<code>PNG</code>，当分辨率比较高的时候体积往往比较大，因此要想提高网站的速度就有必要将图片体积压缩，这里参考店长的推荐，无损压缩推荐<a target="_blank" rel="noopener" href="https://tinypng.com/">Tinypng</a>，有损压缩推荐<a target="_blank" rel="noopener" href="https://github.com/meowtec/Imagine/releases">imagine</a>。</p><table><thead><tr><th style="text-align:left"></th><th style="text-align:center">TinyPNG</th><th>Imagine</th></tr></thead><tbody><tr><td style="text-align:left">特点</td><td style="text-align:center">无损压缩</td><td>有损压缩，以牺牲图像质量， 降低图像色彩来达到缩减图像大小的目的。</td></tr><tr><td style="text-align:left">优点</td><td style="text-align:center">能够完全保留图像色彩，不损伤图像质量</td><td>1. 压缩程度高，支持转<code>png</code>为<code>jpg</code>或<code>webp</code>，进一步减少图片大小 2. 软件支持一次处理多张图片，无上限，处理完成支持直接批量覆盖原文件或重命名</td></tr><tr><td style="text-align:left">缺点</td><td style="text-align:center">单次仅能上传20张图片，每张限制大小为5MB，无法处理更大图片。</td><td>PNG转其他格式为不可逆操作（指覆盖保存后），且可能反而会增加图片大小。</td></tr></tbody></table><p>在这里还给大家推荐一个非常实用的网站：<a target="_blank" rel="noopener" href="https://imagestool.com/zh_CN/index.html">imagesTool</a></p><p><img src="https://source.fomal.cc/siteshot/imagestool.com.jpg" alt="" loading="lazy"></p><p>这个网站不仅仅支持将<code>PNG</code>与<code>JPG</code>格式的图片批量（完全没有数量限制那种）转化为<code>webp</code>和<code>avif</code>（chrome推荐的一种压缩率更高的编码方式），而且还能改变图片的原始分辨率，甚至将图片压缩到指定的大小，下面演示了一张图压缩之路！<br><img src="https://s1.vika.cn/space/2022/10/25/c82f67799a524abc8cbaef90b8bf9131" alt="image-20221025131104569" loading="lazy"></p><p>我们选择了将<code>PNG</code>转化为<code>webp</code>格式，画质为<code>High</code>，图片规模缩小为<code>80%</code>，压缩率达到94%；而选择将<code>PNG</code>转化为<code>avif</code>格式，画质为<code>High</code>，图片规模缩小为<code>80%</code>，压缩率达到95%，这样下来我们可以把所有图片几乎都可以控制在<code>500KB</code>以下，而且肉眼观察画质没有明显的不同。</p><p><img src="https://s1.vika.cn/space/2022/10/25/6e15b7e6ad79406b8320108aaa8e62a9" alt="image-20221025130942155" loading="lazy"></p><p>使用建议:如果没有特别要求，直接使用Imagine进行有损压缩即可。虽然说是有损压缩，但是默认压缩会自主计算压缩程度，一般默认程度就能节省70%空间，且肉眼几乎发现不了图片压缩情况。同时我个人是比较推荐一步到位直接压缩成<code>webp</code>格式，虽然在一些未适配的浏览器（例如IE浏览器）上可能出现无法查看图片的情况，但是压缩率是真的高，图片一路下来压缩个<code>80%</code>毫无压力。如果对图片分辨率要求不太高或者图片分辨率原本就太高了，可以考虑缩小分辨率，结合上面几项，甚至可以压缩<code>90%</code>的大小！</p><h3 id="图片懒加载"><a class="headerlink" href="#图片懒加载"></a>图片懒加载</h3><p>图片懒加载是指只加载目前能看到及其附近的页面上的图片，有节省流量与提高性能的作用。Butterfly主题内置了图片懒加载的选项，在<code>_config.butterfly.yml</code>文件下将对应项设置为如下即可：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Lazyload (圖片懶加載)</span></span><br><span class="line"><span class="comment"># https://github.com/verlok/vanilla-lazyload</span></span><br><span class="line"><span class="attr">lazyload:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">site</span> <span class="comment"># site/post 选择在哪些地方启用图片懒加载</span></span><br><span class="line">  <span class="attr">placeholder:</span> 	<span class="comment"># 你自己喜欢的图片</span></span><br><span class="line">  <span class="attr">blur:</span> <span class="literal">true</span>	<span class="comment"># 模糊效果</span></span><br></pre></td></tr></table></figure><h2 id="字体二级压缩"><a class="headerlink" href="#字体二级压缩"></a>字体二级压缩</h2><p>我们从网上下载的字体通常都是<code>TTF</code>格式，ttf(TrueTypeFont)是一种字库名称，是Apple公司和Microsoft公司共同推出的字体文件格式，也是最常用的格式之一，但是一些好看的字体往往体积都会很大，网站每次进去都要加载一个这么大的文件，速度肯定会很慢！例如下面这个筑紫A丸2.0的标准体ttf格式的字体文件，体积约为23MB。</p><p><img src="https://s1.vika.cn/space/2022/10/25/ca08a96314c5429b934b7ef977854650" alt="image-20221025131822607" loading="lazy"></p><p>这部分参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/littleduo/article/details/124563106">有效的压缩字体方法</a></p><p>一个有效的压缩方法是：<code>fonttools编码压缩+转woff2格式</code>二级压缩</p><h3 id="使用-fonttools-压缩字体文件"><a class="headerlink" href="#使用-fonttools-压缩字体文件"></a>使用 fonttools 压缩字体文件</h3><p>需要 <code>Python</code> 环境，并已安装好 <code>pip</code>，使用 <code>pip</code> 来安装 <code>fonttools</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install fonttools</span><br></pre></td></tr></table></figure><p>下载已经整理好的字体编码列表文件<code>sc_unicode.txt</code> <a target="_blank" rel="noopener" href="https://gist.githubusercontent.com/imaegoo/d64e5088b723c2e02c40985f55ff12db/raw/5ebd2ce49418c73459a9dfe050483409306a6c1d/sc_unicode.txt">点这里进行下载</a>。</p><p>将你要压缩的字体ttf文件和刚刚下载的sc_unicode.txt编码文件放进去同一个文件夹，进入到该文件夹的控制台如下命令然后回车</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyftsubset ZhuZiAWan-3.ttf --unicodes-file=sc_unicode.txt</span><br></pre></td></tr></table></figure><p><img src="https://s1.vika.cn/space/2022/10/25/922e9871848443c1aa79f7ca01c9bfe7" alt="image-20221025133032806" loading="lazy"></p><p><img src="https://s1.vika.cn/space/2022/10/25/69bee2e71ec24c1eb6c4c9d6dd874f5a" alt="image-20221025133103786" loading="lazy"></p><p>然后就会得到图片所示的subset结尾的编码压缩后的ttf文件，体检体积已经从23MB下降到3MB。</p><h3 id="利用CloudConvert将TTF格式转换成woff2-格式"><a class="headerlink" href="#利用CloudConvert将TTF格式转换成woff2-格式"></a>利用CloudConvert将<code>TTF</code>格式转换成<code>woff2</code> 格式</h3><p>进去国外平台<a target="_blank" rel="noopener" href="https://cloudconvert.com/">CloudConvert</a>（国内速度可能会慢一些），将TTF格式的字体文件转化为<code>woff2</code>格式</p><p><img src="https://s1.vika.cn/space/2022/10/25/10aa744585094dbf9914ac029500f51c" alt="image-20221025133728970" loading="lazy"></p><p>最后压缩成从<code>23MB</code>的文件压缩成<code>1.5MB</code>，足足压缩了十几倍，压缩率十分高！</p><h2 id="css和js文件优化"><a class="headerlink" href="#css和js文件优化"></a>css和js文件优化</h2><h3 id="压缩css与js文件"><a class="headerlink" href="#压缩css与js文件"></a>压缩css与js文件</h3><ul><li><p>如果是用<code>VSCODE</code>进行网站搭建的小伙伴，可以下载插件<a target="_blank" rel="noopener" href="https://github.com/olback/es6-css-minify/tree/3.0">JS &amp; CSS Minifier (Minify)</a></p></li><li><p>该插件支持将<code>js</code>和<code>css</code>文件的格式进行压缩，降低文件体积</p></li><li><p>使用方法：安装插件后，在<code>js</code>和<code>css</code>文件界面右键，选择<code>Minify Document</code>，插件会生成一个文件名为<code>xxx.min.css</code>或者<code>xxx.min.js</code>的文件，这就是压缩后的文件，在引入的时候直接引用这个压缩后的文件即可。</p></li></ul><p><img src="https://s1.vika.cn/space/2022/10/25/1e054153b72f4f429dc3a9a6086ccdb5" alt="image-20221025134609440" loading="lazy"></p><h3 id="gulp批量压缩"><a class="headerlink" href="#gulp批量压缩"></a>gulp批量压缩</h3><p>这是压缩全局静态资源的教程，可以参考店长的文章：</p><p><a target="_blank" rel="noopener" href="https://akilar.top/posts/49b73b87/">使用gulp压缩博客静态资源</a></p><p>使用gulp压缩博客静态资源</p><p><a target="_blank" rel="noopener" href="https://akilar.top/posts/49b73b87/">https://akilar.top/posts/49b73b87/</a></p><h3 id="减少加载项"><a class="headerlink" href="#减少加载项"></a>减少加载项</h3><p>当网站的东西多起来了之后，会越来越卡顿，这时候推荐以下几个优化方向：</p><ul><li>减少卡片的出场动画<code>wowjs</code>、<code>Live2D</code>、<code>canvas</code>元素等(其中Live2D是比较消耗资源的)</li><li>如果部分js和css文件只有部分页面需要引用，尽量不全局引用，同时删除空格、空行、注释、减少无意义的单位</li><li>css文件尽量添加media字段指定加载设备，js文件的引入可以加入 的 <code>async</code>、<code>defer</code> 属性异步加载，不阻塞 DOM 渲染</li></ul><h2 id="无服务器下的资源加速策略"><a class="headerlink" href="#无服务器下的资源加速策略"></a>无服务器下的资源加速策略</h2><h3 id="可用的免费CDN选择"><a class="headerlink" href="#可用的免费CDN选择"></a>可用的免费CDN选择</h3><p><strong>1.staticaly</strong></p><p>官网地址：<a target="_blank" rel="noopener" href="https://www.staticaly.com">https://www.staticaly.com</a><br>轻松地从GitHub / GitLab / Bitbucket等加载您的项目 没有流量限制或限制。</p><p>文件通过超快速全球CDN提供。 在URL（不是分支）中使用特定标记或提交哈希。<br>根据URL永久缓存文件。 除master分支外，文件在浏览器中缓存1年。 具体用法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># GitHub CDN</span><br><span class="line">https://cdn.staticaly.com/gh/:user/:repo/:tag/:file</span><br><span class="line">https://cdn.staticaly.com/gh/growvv/growvv.github.io/master/README.md</span><br><span class="line"></span><br><span class="line"># GitLab CDN</span><br><span class="line">https://cdn.staticaly.com/gl/:user/:repo/:tag/:file</span><br><span class="line"></span><br><span class="line"># Bitbucket CDN</span><br><span class="line">https://cdn.staticaly.com/bb/:user/:repo/:tag/:file</span><br><span class="line"></span><br><span class="line"># WordPress CDN</span><br><span class="line">https://cdn.staticaly.com/wp/c/:version/wp-includes/:file  </span><br><span class="line">https://cdn.staticaly.com/wp/p/:plugin_name/:version/:file  </span><br><span class="line">https://cdn.staticaly.com/wp/t/:theme_name/:version/:file</span><br><span class="line"></span><br><span class="line"># Imgpx CDN</span><br><span class="line">https://cdn.staticaly.com/img/:image_url</span><br><span class="line"></span><br><span class="line"># Favicons CDN</span><br><span class="line">https://cdn.staticaly.com/favicons/:favicon_url</span><br></pre></td></tr></table></figure><p><strong>2.githack</strong></p><p>直接从GitHub，Bitbucket或GitLab提供原始文件<br>官网地址：<a target="_blank" rel="noopener" href="https://liubing.me/goto/http://raw.githack.com">http://raw.githack.com/</a> 具体用法和上面的<code>staticaly</code>很类似</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Github CDN</span><br><span class="line">//主分支</span><br><span class="line">https://rawcdn.githack.com/liub1934/LB-Blog/master/wp-content/themes/Memory/emoji/xiaodianshi/baiyan.png</span><br><span class="line"></span><br><span class="line">//版本分支</span><br><span class="line">https://rawcdn.githack.com/liub1934/LB-Blog/8806f440d3f9a7cc3e6125d7d75564e40262c6a8/wp-content/themes/Memory/emoji/xiaodianshi/baiyan.png</span><br></pre></td></tr></table></figure><p><strong>3.TianliCDN</strong></p><p><a target="_blank" rel="noopener" href="https://tianli-blog.club/jsd/">https://tianli-blog.club/jsd/</a></p><p>轻量级私人CDN，申请见：<a target="_blank" rel="noopener" href="https://tianli-blog.club/jsd/">https://tianli-blog.club/jsd/</a></p><p><strong>4.CDN链接替换jsdelivr提升速度</strong></p><p>详见 <a target="_blank" rel="noopener" href="https://blog.zhheo.com/p/790087d9.html">Butterfly CDN链接更改指南，替换jsdelivr提升访问速度</a></p><p>5.UNPKG</p><p>见：<a target="_blank" rel="noopener" href="https://unpkg.com/">https://unpkg.com/</a></p><h3 id="免费图床推荐"><a class="headerlink" href="#免费图床推荐"></a>免费图床推荐</h3><ol><li><p>目前我是用的Github公共仓库+Vercel部署加速，速度还可以，关键是支持增量更新和自动部署，不过前期的配置比较麻烦点，你也可以选用Github公共仓库+Cloudflare部署加速，速度和Vercel接近。</p></li><li><p>大概步骤就是建立一个公共仓库，把你本地的图片推上这个仓库，然后将这个仓库部署托管于Vercel，再用一个二级域名绑定这个部署，那就可以通过二级域名+路径的方式访问到图片与资源了。每次仓库更新导致指定分支更新，都会触发Vercel重新部署，实现自动化流程。（这部分教程以后有机会详细写）</p></li><li><p>如果不想折腾或者只想存少量不太重要的图片，那么完全可以用公共的免费图床，下面列举了一些免费的图床：</p><ul><li><p><a target="_blank" rel="noopener" href="https://smms.app/">SMMS</a></p></li><li><p><a target="_blank" rel="noopener" href="https://www.superbed.cn/">聚合图床</a></p></li><li><p><a target="_blank" rel="noopener" href="https://www.hualigs.cn/">遇见图床</a></p></li><li><p><a target="_blank" rel="noopener" href="https://postimages.org/">PostImage</a></p></li><li><p><a target="_blank" rel="noopener" href="https://imgse.com/">路过图床</a></p></li><li><p><a target="_blank" rel="noopener" href="https://www.imgurl.org/">imgURL</a></p></li><li><p><a target="_blank" rel="noopener" href="https://dash.cloudflare.com/">Cloudflare Pages</a></p></li><li><p><a target="_blank" rel="noopener" href="https://imgbox.com/">imgbox</a></p></li><li><p><a target="_blank" rel="noopener" href="https://pic.iqy.ink/upload">Lsky Pro</a></p></li><li><p><a target="_blank" rel="noopener" href="https://upload.cc/">Upload.cc</a></p></li><li><p><a target="_blank" rel="noopener" href="https://imagelol.com/">imagelol</a></p></li></ul></li></ol><h3 id="域名绑定的好处"><a class="headerlink" href="#域名绑定的好处"></a>域名绑定的好处</h3><p>目前Vercel的域已经被GFW墙了，如果想用Vercel托管网站又想在国内访问又不想科学上网，只能绑定国内域名，还有想用Vercel来进行资源加速也必须是有国内域名的，同时域名还可以拥有自己的域名邮箱与网站标识符，总之域名还是很有用的。对于静态网站来说你可以没有服务器，但是你不能没有域名。</p><h3 id="托管平台的选择"><a class="headerlink" href="#托管平台的选择"></a>托管平台的选择</h3><p>目前能够托管静态网站的平台有以下几个</p><ol><li><a target="_blank" rel="noopener" href="https://vercel.com/">Vercel</a>（不限量、速度较快） 推荐指数：🌟🌟🌟🌟🌟</li><li><a target="_blank" rel="noopener" href="https://www.cloudflare.com/">Cloudflare</a>（不限量、速度还可以） 推荐指数：🌟🌟🌟🌟</li><li><a target="_blank" rel="noopener" href="https://www.4everland.org/">4EVERLAND</a>（流量限制100GB、速度还可以、适合做备用线路） 推荐指数：🌟🌟🌟</li><li><a target="_blank" rel="noopener" href="https://www.netlify.com/">Netlify</a>（流量限制100GB、速度还可以、适合做备用线路） 推荐指数：🌟🌟🌟</li><li><a target="_blank" rel="noopener" href="https://pages.github.com/">Github Pages</a>（不限量、速度较慢） 推荐指数：🌟🌟</li><li><a target="_blank" rel="noopener" href="https://gitee.com/">Gitee Pages</a>（不限量、速度还可以、但是Gitee与国外平台兼容性差） 推荐指数：🌟🌟</li><li>还有其他的例如<a target="_blank" rel="noopener" href="https://docs.gitlab.com/ee/user/project/pages/">GitLab Pages</a>等就不说了，估计没啥人用</li></ol><h2 id="实用工具"><a class="headerlink" href="#实用工具"></a>实用工具</h2><h3 id="Lighthouse-2"><a class="headerlink" href="#Lighthouse-2"></a>Lighthouse</h3><p>Lighthouse 是一个网站性能测评工具， 它是 Google Chrome 推出的一个开源自动化工具，能够对 PWA 和网页多方面的效果指标进行评测，并给出最佳实践的建议以帮助开发者改进网站的质量。它的使用方法也非常简单，我们只需要提供一个要测评的网址，它将针对此页面运行一系列的测试，然后生成一个有关页面性能的报告。通过报告我们就可以知道需要采取哪些措施来改进应用的性能和体验。</p><p>在高版本（应该是 &gt;= 60）的 Chrome 浏览器中，Lighthouse 已经直接集成到了调试工具 DevTools 中了，因此不需要进行任何安装或下载。按 F12 打开开发者工具，可以看到在 console、security 等选项后面有一个 Audits （安装了lighthouse插件或者是高版本的谷歌浏览器可能显示的是 lighthouse）选项，选择该选项，然后点击 generate report 即可。</p><p><img src="https://s1.vika.cn/space/2022/10/25/d278a76bbd774b1d9912e74aa15b22c5" alt="image-20221025173341316" loading="lazy"></p><p><img src="https://s1.vika.cn/space/2022/10/25/1d8b86f79de7449782b0c73e897edeb0" alt="image-20221025173705571" loading="lazy"></p><p>使用 Lighthouse 对网站进行测评后，我们会得到一份评分报告，它包含了性能（Performance），访问无障碍（Accessibility），最佳实践（Best Practice），搜索引擎优化（SEO），PWA（Progressive Web App）五个部分：</p><h4 id="性能（Performance）"><a class="headerlink" href="#性能（Performance）"></a>性能（Performance）</h4><p>性能评分的分值区间是0到100，如果出现0分，通常是在运行 Lighthouse 时发生了错误，满分100分代表了网站已经达到了98分位值的数据，而50分则是75分位值的数据。</p><p>影响评分的性能指标：性能测试结果会分成 Metrics，Diagnostic，Opportunities 三部分，但只有 Metrics 部分的指标项会对分数产生直接影响。</p><p>Lighthouse 会衡量以下 Metrics 性能指标项：</p><ul><li>首次内容绘制（First Contentful Paint）。即浏览器首次将任意内容（如文字、图像、canvas 等）绘制到屏幕上的时间点。</li><li>首次有效绘制（First Meaningful Paint）。衡量了用户感知页面的主要内容（primary content）可见的时间。对于不同的站点，首要内容是不同的，例如：对于博客文章，标题及首屏文字是首要内容，而对于购物网站来说，图片也会变得很重要。</li><li>首次 CPU 空闲（First CPU Idle）。即页面首次能够对输入做出反应的时间点，其出现时机往往在首次有效绘制完成之后。该指标目前仍处于实验阶段。</li><li>可交互时间（Time to Interactive）。指的是所有的页面内容都已经成功加载，且能够快速地对用户的操作做出反应的时间点。该指标目前仍处于实验阶段。</li><li>速度指标（Speed Index）。衡量了首屏可见内容绘制在屏幕上的速度。在首次加载页面的过程中尽量展现更多的内容，往往能给用户带来更好的体验，所以速度指标的值约小越好。</li><li>输入延迟估值（Estimated Input Latency）。这个指标衡量了页面对用户输入行为的反应速度，其基准值应低于 50ms。</li></ul><p>Metrics 部分的指标项会直接影响分数，可以作为我们的主要参考点。</p><p>另外的两部分中， <strong>Opportunities</strong> 指的是优化机会，它提供了详细的建议和文档，来解释低分的原因，帮助我们具体进行实现和改进。<strong>Diagnostics</strong> 指的是现在存在的问题，为进一步改善性能的实验和调整给出了指导。这两者不会纳入分数的计算。</p><p>每一项性能指标对评分的贡献都有其计算逻辑，Lighthouse 会将原始的性能值映射成为 0-100 之间的数字。</p><p>例如，FMP（First Meaningful Paint）的原始值是从页面初始化开始到主要内容渲染成功的耗时，根据真实站点的数据，顶级性能的站点的 FMP 值约为 1220ms，这个值会被映射成 Lighthouse 的 99 分。</p><p>针对不同的评分，Lighthouse 用了不同的颜色进行标注，分值区间和颜色的对应关系如下：</p><ul><li>0 - 49（慢）：红色</li><li>50 - 89（平均值）： 橙色</li><li>90 - 100（快）： 绿色</li></ul><p><strong>访问无障碍（Accessibility）</strong></p><p>访问无障碍评分的分值由相关指标的加权平均值计算而来。可以在<a target="_blank" rel="noopener" href="https://www.cnblogs.com/ypSharing/p/15793767.html#gid=0">评分详情</a>查阅每项指标的具体权重。同理，较大权重的指标项对分数的影响较大。</p><p>无障碍性的每个指标项测试结果为pass或者fail，与性能指标项的计算方式不同，当页面只是部分通过某项指标时，页面的这项指标将不会得分。例如，如果页面中的一些元素有屏幕阅读器友好的命名，而其他的元素没有，那么这个页面的 screenreader-friendly-names 指标项得分为0。</p><p><strong>最佳实践（优化）（Best Practice）</strong></p><p>最佳实践评分的分数区间为0-100。影响这项评分的指标项的权重都是相同的。</p><p>比如：推荐使用 https，跨域的跳转链接需要使用 rel 标识，不能使用废弃的 API等等。</p><p><strong>搜索引擎优化（SEO）</strong></p><p>比如：图片元素使用 alt 属性等等提高搜索引擎搜索排名，便于搜索引擎能找到你这个网站。</p><p><strong>PWA（Progressive Web App）</strong></p><p>Lighthouse 使用 PWA 基准检查项列表（Baseline PWA Checklist）进行测评，测评结果将这些指标项分成了四个类别，共包含12个自动测试项和3个手动测试项，其中各个自动测试项的评分权重是相同的。PWA 的评测指标对我们来说非常重要，我们可以从这四个类别详细了解一下基准指标项。</p><ul><li><p><strong>快速可靠：</strong></p><ol><li>页面在移动网络条件下能够快速加载。</li><li>在离线条件下页面能够返回状态码200。这里我们可以通过 Service Worker 来实现离线可用。</li><li>start_url 在离线条件下返回状态码200。start_url 是前面章节我们提到过的 manifest.json 中的一个属性，它指定了用户打开该 PWA 时加载的 URL。</li></ol></li><li><p><strong>可安装：</strong></p><ol><li>始终使用 HTTPS。</li><li>注册 Service Worker 来缓存页面以及 start_url。</li><li>使用 manifest 文件来实现安装 PWA 的需求，浏览器能够主动通知用户将应用添加到桌面，增加留存率。</li></ol></li><li><p><strong>PWA 优化：</strong></p><ol><li>将 HTTP 流量重定向到 HTTPS。</li><li>配置自定义启动画面。</li><li>设置地址栏主题颜色。</li><li>页面内容针对视口大小自适应，对移动用户的展示更友好。</li><li>使用了标签，并设置了 width 或 initial-scale 属性。</li><li>当 JavaScript 文件不可用时，提供降级措施，页面能显示基本内容而不出现白屏。</li></ol></li><li><p><strong>手动测试项：</strong></p><ol><li>站点跨浏览器可用，如主流浏览器 Chrome, Edge, Firefox 及 Safari 等。</li><li>页面间切换流畅，即使在较差的网络环境下，切换动画也应该简洁顺畅，这是提高用户感知体验的关键。</li><li>保证每个页面都有独一无二的 URL，能够在新的浏览器窗口打开，且方便在社交媒体上进行分享。</li></ol></li></ul><p>除了上述基准指标项之外，为了让 PWA 的体验更加完美，还有一些 Lighthouse 未实现检查的进阶指标，也就是可以作为示范性参考的 PWA 的指标，比如用户体验、缓存、推送通知等等。</p><h3 id="灵雀监控"><a class="headerlink" href="#灵雀监控"></a>灵雀监控</h3><p>灵雀应用监控平台最国内老牌知名免费网站统计51LA网站统计旗下的一个 Web 性能与 bug 监控工具平台，发布后在站长圈内也有一些较好的评价，访问地址：<a target="_blank" rel="noopener" href="https://perf.51.la/">https://perf.51.la</a>。51LA灵雀应用监控平台，专注于帮您及时发现异常问题，帮助运营人员发现网站风险，协助开发者修复网页 bug，从而提升用户体验。产品面向产品，运营以及开发人员作为网站性能及异常信息收集工具。开发人员可以通过页面统计获取用户平均的页面统计信息和网页 Performance 的各个性能指标进行分析，如DNS 解析时间，TTFB、服务器响应时间、白屏时间、页面完全加载时长等是否达标等判断。灵雀应用监控平台为开发人员提供了包含程序异常收集、性能分析、资源异常分析、页面外链跳转分析、可疑脚本/iframe 监控等网站优化和用户体验改进所需的信息。</p><p><strong>特点：</strong></p><ul><li>大家是否有遇到过下面这些情况：</li><li>网站打开速度慢找不到原因；</li><li>部分访客无法打开网站又不能及时得到反馈；</li><li>网站突然无流量或被k 却无从查起起因；</li></ul><p><strong>1.异常分析，精准定位</strong></p><p><img src="https://s1.vika.cn/space/2022/10/25/2b1d0d3c50394c688f8046819584f7d9" alt="image-20221025174453208" loading="lazy"></p><p>实时监控网站发生的程序错误、网络请求异常、资源加载异常等潜在问题，精准采集错误上报的页面、错误发生时间、UA等详细的用户设备数据，帮您快速定位异常，提高debug效率。</p><p><strong>2.性能监测，定向优化</strong></p><p><img src="https://s1.vika.cn/space/2022/10/25/ca16cee5817742389e20d66a9f11df46" alt="image-20221025174556202" loading="lazy"></p><p>采用51LA V6网站统计的多维分析技术，详细展示分析网站性能加载状况，确定网站体验优化方向。</p><p><strong>3.外链监控，规避暗链</strong></p><p><img src="https://s1.vika.cn/space/2022/10/25/52897c1a5b2042ef8bf27ae299b1ea0c" alt="image-20221025174628427" loading="lazy"></p><p>提供24小时全方位监控站内外链的功能，定位异常跳转，助您快速识别暗链链接，降低网站被k风险，提升网站安全性。</p><p>详见<a target="_blank" rel="noopener" href="https://blog.zhheo.com/p/c7c43433.html">51la统计体验报告：很全面的惊喜，Butterfly适配51la统计</a></p></article><div class="post-copyright"><div class="post-copyright__author_group"><a class="post-copyright__author_img" href="/about/"><img class="post-copyright__author_img_front" src="/img/logo.jpg"></a><div class="post-copyright__author_name">Panjoel's Blog</div><div class="post-copyright__author_desc">一句话说得合宜，就如金苹果在银网子里</div></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div id="quit-box" onclick="RemoveRewardMask()"></div><div class="post-reward"><div class="reward-button" title="赞赏作者" onclick="AddRewardMask()"><i class="solitude st-hand-heart-fill"></i>赞赏作者</div><div class="reward-main"><ul class="reward-all"><span class="reward-title">感谢您的赞赏。</span><ul class="reward-group"><li class="reward-item"><a target="_blank" rel="noopener" href="https://afdian.net/a/panjoel"><img class="post-qr-code-img nolazyload" src="https://s21.ax1x.com/2024/06/08/pkt5VSS.png" alt="爱发电" style="border-color:var(--efu-purple)"></a><div class="post-qr-code-desc">爱发电</div></li></ul><a class="reward-main-btn" href="/about"><div class="reward-text">赞赏名单</div><div class="reward-dec">因为有你们的支持，我才体会到写文章的价值。</div></a></ul></div></div><script>function RemoveRewardMask() {
    let rewardMainElements = document.querySelectorAll(".reward-main");
    let quitBoxElement = document.querySelector("#quit-box");

    rewardMainElements.forEach(element => {
        element.style.display = "none";
    });

    if (quitBoxElement) {
        quitBoxElement.style.display = "none";
    }
}

function AddRewardMask() {
    let rewardMainElements = document.querySelectorAll(".reward-main");
    let quitBoxElement = document.querySelector("#quit-box");

    rewardMainElements.forEach(element => {
        element.style.display = "flex";
    });

    if (quitBoxElement) {
        quitBoxElement.style.display = "flex";
    }
}</script></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本文是原创文章，采用<a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0</a>协议，完整转载请注明来自<a href="/">Panjoel's Blog</a></span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/hexo/"><span class="tags-punctuation"></span>hexo<span class="tagsPageCount">1</span></a></div></div><div class="social-share"><a class="social-share-ico icon-qq" target="_blank" rel="noopener" href="https://connect.qq.com/widget/shareqq/index.html?url=https%3A%2F%2Fblog.panjoel.top%2F%25E7%25BD%2591%25E7%25AB%2599%25E6%2580%25A7%25E8%2583%25BD%25E4%25BC%2598%25E5%258C%2596%25E7%259A%2584%25E4%25B8%2580%25E4%25BA%259B%25E5%25B0%258F%25E6%258A%2580%25E5%25B7%25A7%2F&amp;title=%E7%BD%91%E7%AB%99%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%8A%80%E5%B7%A7&amp;desc=%E5%85%B3%E4%BA%8E%E7%BD%91%E7%AB%99%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%8A%80%E5%B7%A7%EF%BC%8C%E6%9B%B4%E5%A5%BD%E5%9C%B0%E5%AF%B9%E9%A1%B5%E9%9D%A2%E8%BF%9B%E8%A1%8C%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96&amp;summary=%E5%85%B3%E4%BA%8E%E7%BD%91%E7%AB%99%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%8A%80%E5%B7%A7%EF%BC%8C%E6%9B%B4%E5%A5%BD%E5%9C%B0%E5%AF%B9%E9%A1%B5%E9%9D%A2%E8%BF%9B%E8%A1%8C%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96&amp;site=%E7%BD%91%E7%AB%99%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%8A%80%E5%B7%A7&amp;pics=https%3A%2F%2Fs1.ax1x.com%2F2023%2F01%2F06%2FpSATc6O.png" title="QQ"></a><a class="social-share-ico icon-facebook" target="_blank" rel="noopener" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fblog.panjoel.top%2F%25E7%25BD%2591%25E7%25AB%2599%25E6%2580%25A7%25E8%2583%25BD%25E4%25BC%2598%25E5%258C%2596%25E7%259A%2584%25E4%25B8%2580%25E4%25BA%259B%25E5%25B0%258F%25E6%258A%2580%25E5%25B7%25A7%2F" title="Facebook"></a><a class="social-share-ico icon-telegram" target="_blank" rel="noopener" href="https://t.me/share/url?url=https%3A%2F%2Fblog.panjoel.top%2F%25E7%25BD%2591%25E7%25AB%2599%25E6%2580%25A7%25E8%2583%25BD%25E4%25BC%2598%25E5%258C%2596%25E7%259A%2584%25E4%25B8%2580%25E4%25BA%259B%25E5%25B0%258F%25E6%258A%2580%25E5%25B7%25A7%2F&amp;text=%E7%BD%91%E7%AB%99%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%8A%80%E5%B7%A7" title="Telegram"></a><a class="social-share-ico icon-whatsapp" target="_blank" rel="noopener" href="https://api.whatsapp.com/send?text=%E7%BD%91%E7%AB%99%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%8A%80%E5%B7%A7 https%3A%2F%2Fblog.panjoel.top%2F%25E7%25BD%2591%25E7%25AB%2599%25E6%2580%25A7%25E8%2583%25BD%25E4%25BC%2598%25E5%258C%2596%25E7%259A%2584%25E4%25B8%2580%25E4%25BA%259B%25E5%25B0%258F%25E6%258A%2580%25E5%25B7%25A7%2F" title="WhatsApp"></a></div></div><nav class="needEndHide pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/Python%E8%A3%85%E9%A5%B0%E5%99%A8/"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Python装饰器</div></div></a></div><div class="next-post pull-right"><a href="/Python-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E4%B8%80%E6%96%87%E9%80%9A/"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Python 正则表达式一文通</div></div></a></div></nav><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="solitude st-chat-fill"></i><span> 评论</span></div></div><div class="comment-wrap"><div id="twikoo-wrap"></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><div class="author-info__top-group"><div class="author-info__sayhi" id="author-info__sayhi" onclick="sco.changeSayHelloText()">sayhello.morning</div></div></div><div class="avatar-img-group"><img class="avatar-img" alt="头像" src= "/img/loading.gif" data-lazy-src="/img/avatar.png"><div class="avatar-sticker"><img class="avatar-sticker-img" src= "/img/loading.gif" data-lazy-src="https://7.isyangs.cn/34/65f2e4e0423cc-34.png" alt="心情贴纸"></div></div><div class="author-info__description_group"><div class="author-info__description">分享<b>学习笔记</b>和<b>技术文章</b><br>内容涵盖<b>数学</b>、<b>计算机科学</b>、<b>物理</b>等多个领域</div><div class="author-info__description2">相信你可以在这里找到对你有用的知识和教程。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/about/"><div class="author-info__name">Panjoel</div><div class="author-info__desc">一句话说得合宜，就如金苹果在银网子里</div></a><div class="card-info-social-icons is-center"><a class="social-icon" target="_blank" rel="noopener" href="https://github.com/panjoel" title="Github"><i class="solitude st-github-line"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="solitude st-menu-line"></i><span>文章目录</span></div><div class="toc-content" id="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">理论部分</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86"><span class="toc-text">浏览器渲染原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B"><span class="toc-text">进程与线程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%93%E5%85%A5url%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%B1%95%E7%A4%BA%E5%AE%8C%E6%95%B4%E8%BF%87%E7%A8%8B"><span class="toc-text">输入url到页面展示完整过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%A4%84%E7%90%86%E6%AF%8F%E4%B8%80%E5%B8%A7%E7%9A%84%E6%B5%81%E7%A8%8B"><span class="toc-text">浏览器处理每一帧的流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Chrome%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7"><span class="toc-text">Chrome性能优化相关工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Chrome-Performance-%E6%80%A7%E8%83%BD"><span class="toc-text">Chrome Performance(性能)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Coverage-%E8%A6%86%E7%9B%96%E7%8E%87"><span class="toc-text">Coverage(覆盖率)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lighthouse"><span class="toc-text">Lighthouse</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Network-%E7%BD%91%E7%BB%9C"><span class="toc-text">Network(网络)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E9%A1%B5%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-text">网页性能优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5"><span class="toc-text">网络优化策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5"><span class="toc-text">浏览器渲染优化策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5"><span class="toc-text">静态文件优化策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%82%A8%E5%AD%98%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5"><span class="toc-text">浏览器储存优化策略</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SessionStorage"><span class="toc-text">SessionStorage</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5"><span class="toc-text">其他优化策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8PWA%E6%8F%90%E9%AB%98%E7%94%A8%E6%88%B7%E4%BD%93%E9%AA%8C"><span class="toc-text">使用PWA提高用户体验</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">优化小技巧实操</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9"><span class="toc-text">图片压缩</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E5%A4%9A%E7%BA%A7%E5%8E%8B%E7%BC%A9"><span class="toc-text">图片多级压缩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E6%87%92%E5%8A%A0%E8%BD%BD"><span class="toc-text">图片懒加载</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E4%BD%93%E4%BA%8C%E7%BA%A7%E5%8E%8B%E7%BC%A9"><span class="toc-text">字体二级压缩</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-fonttools-%E5%8E%8B%E7%BC%A9%E5%AD%97%E4%BD%93%E6%96%87%E4%BB%B6"><span class="toc-text">使用 fonttools 压缩字体文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8CloudConvert%E5%B0%86TTF%E6%A0%BC%E5%BC%8F%E8%BD%AC%E6%8D%A2%E6%88%90woff2-%E6%A0%BC%E5%BC%8F"><span class="toc-text">利用CloudConvert将TTF格式转换成woff2 格式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#css%E5%92%8Cjs%E6%96%87%E4%BB%B6%E4%BC%98%E5%8C%96"><span class="toc-text">css和js文件优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%8B%E7%BC%A9css%E4%B8%8Ejs%E6%96%87%E4%BB%B6"><span class="toc-text">压缩css与js文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gulp%E6%89%B9%E9%87%8F%E5%8E%8B%E7%BC%A9"><span class="toc-text">gulp批量压缩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%8F%E5%B0%91%E5%8A%A0%E8%BD%BD%E9%A1%B9"><span class="toc-text">减少加载项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A0%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8B%E7%9A%84%E8%B5%84%E6%BA%90%E5%8A%A0%E9%80%9F%E7%AD%96%E7%95%A5"><span class="toc-text">无服务器下的资源加速策略</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E7%94%A8%E7%9A%84%E5%85%8D%E8%B4%B9CDN%E9%80%89%E6%8B%A9"><span class="toc-text">可用的免费CDN选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E6%8E%A8%E8%8D%90"><span class="toc-text">免费图床推荐</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%9F%E5%90%8D%E7%BB%91%E5%AE%9A%E7%9A%84%E5%A5%BD%E5%A4%84"><span class="toc-text">域名绑定的好处</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%98%E7%AE%A1%E5%B9%B3%E5%8F%B0%E7%9A%84%E9%80%89%E6%8B%A9"><span class="toc-text">托管平台的选择</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="toc-text">实用工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Lighthouse-2"><span class="toc-text">Lighthouse</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%EF%BC%88Performance%EF%BC%89"><span class="toc-text">性能（Performance）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%81%B5%E9%9B%80%E7%9B%91%E6%8E%A7"><span class="toc-text">灵雀监控</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="solitude st-map-line"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/%E5%89%8D%E7%BC%80%E5%92%8C-%E7%BA%BF%E6%AE%B5%E6%A0%91-%E8%AE%B0%E5%BF%86%E5%8C%96%E6%90%9C%E7%B4%A2/" title="前缀和-线段树-记忆化搜索"><img alt="前缀和-线段树-记忆化搜索" src= "/img/loading.gif" data-lazy-src="https://cdn.luogu.com.cn/upload/image_hosting/894n1dxk.png"></a><div class="content"><a class="title" href="/%E5%89%8D%E7%BC%80%E5%92%8C-%E7%BA%BF%E6%AE%B5%E6%A0%91-%E8%AE%B0%E5%BF%86%E5%8C%96%E6%90%9C%E7%B4%A2/" title="前缀和-线段树-记忆化搜索">前缀和-线段树-记忆化搜索</a><a class="article-recent_post_categories" href="/%E5%89%8D%E7%BC%80%E5%92%8C-%E7%BA%BF%E6%AE%B5%E6%A0%91-%E8%AE%B0%E5%BF%86%E5%8C%96%E6%90%9C%E7%B4%A2/">PFSの泡泡糖</a></div></div><div class="aside-list-item"><a class="thumbnail" href="/%5BNOI1995%5D%E7%9F%B3%E5%AD%90%E5%90%88%E5%B9%B6%E2%80%94%E2%80%94%E9%A2%98%E8%A7%A3/" title="【NOI1995】石子合并——题解"><img alt="【NOI1995】石子合并——题解" src= "/img/loading.gif" data-lazy-src="https://files.catbox.moe/487jbm.jpg"></a><div class="content"><a class="title" href="/%5BNOI1995%5D%E7%9F%B3%E5%AD%90%E5%90%88%E5%B9%B6%E2%80%94%E2%80%94%E9%A2%98%E8%A7%A3/" title="【NOI1995】石子合并——题解">【NOI1995】石子合并——题解</a><a class="article-recent_post_categories" href="/%5BNOI1995%5D%E7%9F%B3%E5%AD%90%E5%90%88%E5%B9%B6%E2%80%94%E2%80%94%E9%A2%98%E8%A7%A3/">PFSの泡泡糖</a></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E4%BD%BF%E7%94%A8Hexo%E7%9A%84%E8%AF%B4%E6%98%8E%E6%8C%87%E5%8D%97/" title="从零开始使用Hexo的说明指南"><img alt="从零开始使用Hexo的说明指南" src= "/img/loading.gif" data-lazy-src="https://files.catbox.moe/sjyouh.png"></a><div class="content"><a class="title" href="/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E4%BD%BF%E7%94%A8Hexo%E7%9A%84%E8%AF%B4%E6%98%8E%E6%8C%87%E5%8D%97/" title="从零开始使用Hexo的说明指南">从零开始使用Hexo的说明指南</a><a class="article-recent_post_categories" href="/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E4%BD%BF%E7%94%A8Hexo%E7%9A%84%E8%AF%B4%E6%98%8E%E6%8C%87%E5%8D%97/">PFSの泡泡糖</a></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E5%BB%BA%E7%B3%BB%E7%AE%80%E5%8D%95%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/" title="建系简单知识汇总"><img alt="建系简单知识汇总" src= "/img/loading.gif" data-lazy-src="https://s1.ax1x.com/2023/01/30/pSdy69P.md.png"></a><div class="content"><a class="title" href="/%E5%BB%BA%E7%B3%BB%E7%AE%80%E5%8D%95%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/" title="建系简单知识汇总">建系简单知识汇总</a><a class="article-recent_post_categories" href="/%E5%BB%BA%E7%B3%BB%E7%AE%80%E5%8D%95%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/">PFSの泡泡糖</a></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E4%B8%A2%E5%BC%83Excel%EF%BC%8CPandas%E4%B8%80%E8%A1%8C%E6%90%9E%E5%AE%9A/" title="丢弃Excel，Pandas一行搞定"><img alt="丢弃Excel，Pandas一行搞定" src= "/img/loading.gif" data-lazy-src="https://s1.ax1x.com/2023/01/06/pSEtyjg.png"></a><div class="content"><a class="title" href="/%E4%B8%A2%E5%BC%83Excel%EF%BC%8CPandas%E4%B8%80%E8%A1%8C%E6%90%9E%E5%AE%9A/" title="丢弃Excel，Pandas一行搞定">丢弃Excel，Pandas一行搞定</a><a class="article-recent_post_categories" href="/%E4%B8%A2%E5%BC%83Excel%EF%BC%8CPandas%E4%B8%80%E8%A1%8C%E6%90%9E%E5%AE%9A/">PFSの泡泡糖</a></div></div></div></div></div></div></main><footer id="footer"><div id="st-footer-bar"><div class="footer-logo"><span>Panjoel</span></div><div class="footer-bar-description">来自 Panjoel 的文章</div><a class="footer-bar-link" href="/about/">了解更多</a></div><div id="footer_deal"></div><div id="st-footer"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div class="copyright">© 2019 - 2024 By&nbsp;<a class="footer-bar-link" href="/">Panjoel</a></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/valor-x/hexo-theme-solitude" alt="主题">主题</a><a class="footer-bar-link cc" href="/null" aria-label="copyright"><i class="solitude st-copyright-line"></i><i class="solitude st-creative-commons-by-line"></i><i class="solitude st-creative-commons-nc-line"></i><i class="solitude st-creative-commons-nd-line"></i></a></div></div></div><div class="comment-barrage needEndHide"></div></footer></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="solitude st-arrow-left-line"></i></div><div class="rightMenu-item" id="menu-forward"><i class="solitude st-arrow-right-line"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="solitude st-restart-line"></i></div><div class="rightMenu-item" id="menu-top"><i class="solitude st-arrow-up-line"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="solitude st-copy-fill"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="solitude st-clipboard-fill"></i><span>粘贴文本</span></div><div class="rightMenu-item" id="menu-commenttext"><i class="solitude st-chat-new-fill"></i><span>引用到评论</span></div><div class="rightMenu-item" id="menu-newwindow"><i class="solitude st-window-fill"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="solitude st-link-line"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="solitude st-copy-fill"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="solitude st-download-cloud-fill"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="solitude st-play-fill"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="solitude st-skip-back-fill"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="solitude st-skip-forward-fill"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="solitude st-copy-fill"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><div class="rightMenu-item" id="menu-randomPost" onclick="toRandomPost()||rm.hideRightMenu()"><i class="solitude st-signal-tower-fill"></i><span>随机短文</span></div><div class="rightMenu-item" onclick='pjax.loadUrl("/categories/")||rm.hideRightMenu()'><i class="solitude st-checkbox-multiple-blank-fill"></i><span>全部分类</span></div><div class="rightMenu-item" onclick='pjax.loadUrl("/tags/")||rm.hideRightMenu()'><i class="solitude st-price-tag-fill"></i><span>全部标签</span></div><div class="rightMenu-item" onclick='window.open("https://afdian.net/a/panjoel/","_blank")||rm.hideRightMenu()'><i class="solitude st-afdian-line"></i><span>赞助博主</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><div class="rightMenu-item" id="menu-commentBarrage" onclick="sco.switchCommentBarrage()"><i class="solitude st-chat-fill"></i><span class="menu-commentBarrage-text">关闭热评</span></div><div class="rightMenu-item" id="menu-darkmode" onclick="sco.switchDarkMode()"><i class="solitude st-moon-clear-fill"></i><span class="menu-darkmode-text">深色模式</span></div></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js?v=1.11.2"></script><script src="/js/main.js?v=1.11.2"></script><script src="/js/third_party/waterfall.min.js?v=1.11.2"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/pjax/0.2.8/pjax.min.js"></script><script src="/js/third_party/universe.min.js?v=1.11.2"></script><script>dark()</script><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/copy-tex.min.js"><script>(() => {
    document.querySelectorAll('#article-container span.katex-display').forEach(item => {
        utils.wrap(item, 'div', {class: 'katex-wrap'})
    })
})();</script><script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/19.1.3/lazyload.iife.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/node-snackbar/0.1.16/snackbar.min.js"></script><script>var meting_api="https://meting.qjqq.cn/?server=:server&type=:type&id=:id&auth=:auth&r=:r"</script><script src="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/meting/2.0.1/Meting.min.js"></script><script>const coverColorConfig = {
    api: 'https://api.qjqq.cn/api/Imgcolor?img=',
    time: 43200000
}</script><script src="/js/covercolor/api.js?v=1.11.2"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js"></script><script src="/js/right_menu.js?v=1.11.2"></script><div class="js-pjax"><script>(() => {
    const getCount = () => {
        const ele = document.querySelectorAll('.twikoo-count')
        if (!ele) return
        twikoo.getCommentsCount({
            envId: 'https://panjoel-twikoo.netlify.app/.netlify/functions/twikoo',
            region: 'ap-shanghai',
            urls: [window.location.pathname],
            includeReply: false
        }).then(res => {
            ele.forEach(item => item.textContent = res[0].count)
        }).catch(err => {
            console.error(err)
        })
    }
    const init = () => {
        twikoo.init(Object.assign({
            el: '#twikoo-wrap',
            envId: 'https://panjoel-twikoo.netlify.app/.netlify/functions/twikoo',
            region: 'ap-shanghai',
            path: window.location.pathname,
            onCommentLoaded: () => {
                GLOBAL_CONFIG.lightbox && utils.lightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
            }
        }, null))

        
        sco.owoBig({
            body: '.OwO-body',
            item: '.OwO-items li'
        })

        barrageTwikoo()
    }

    const loadTwikoo = () => {
        if (typeof twikoo === 'object') setTimeout(init,0)
        else utils.getScript('https://cdnjs.cloudflare.com/ajax/libs/twikoo/1.6.36/twikoo.all.min.js').then(init)
    }

    if ('Twikoo' === 'Twikoo' || false) {
        if (false) utils.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
        else loadTwikoo()
    } else {
        window.loadTwoComment = loadTwikoo
    }
})()</script><script>async function barrageTwikoo() {
    await fetch("https://panjoel-twikoo.netlify.app/.netlify/functions/twikoo", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            event: "COMMENT_GET",
            accessToken: "c6d1a1da97cafeb2a0c42b0a7e8f204d",
            url: window.location.pathname
        })
    }).then(async res => {
        if (!res.ok) throw new Error("HTTP error! status: " + res.status)
        const data = await res.json();
        const init = () => {
            initializeCommentBarrage((data.data).map(item => Object.assign({
                content: item.comment,
                nick: item.nick,
                mailMd5: item.mailMd5,
                id: item.id
            })))
        }
        if (typeof initializeCommentBarrage === "undefined") await utils.getScript('/js/third_party/barrage.min.js?v=1.11.2').then(init)
        else init()
    }).catch(error => console.error("An error occurred while fetching comments: ", error))
}</script></div></div><script>const pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: ['title','#body-wrap','#site-config','meta[name="description"]','.js-pjax','meta[property^="og:"]','#config-diff'],
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
})

document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
})

document.addEventListener('pjax:complete', () => {
    window.refreshFn()

    document.querySelectorAll('script[data-pjax]').forEach(item => {
        const newScript = document.createElement('script')
        const content = item.text || item.textContent || item.innerHTML || ""
        Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
        newScript.appendChild(document.createTextNode(content))
        item.parentNode.replaceChild(newScript, item)
    })

    GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

})

document.addEventListener('pjax:error', (e) => {
    if (e.request.status === 404) {
        pjax.loadUrl('/404.html')
    }
})</script><script>initTheme = () => {
    let isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const cachedMode = utils.saveToLocal.get('theme');
    if (cachedMode === undefined) {
        const nowMode =
            isDarkMode ? 'dark' : 'light'
        document.documentElement.setAttribute('data-theme', nowMode);
    } else {
        document.documentElement.setAttribute('data-theme', cachedMode);
    }
    is_rm && rm.mode(cachedMode === 'dark' && isDarkMode)
}
initTheme()</script><div class="needEndHide" id="nav-music" onclick="sco.musicToggle()"><div id="nav-music-hoverTips">音乐已暂停</div><meting-js id="8226579670" server="netease" type="playlist" mutex="true" preload="none" data-lrctype="0" order="random" theme="var(--efu-main)"></meting-js></div></body></html><script>const posts=["前缀和-线段树-记忆化搜索/","[NOI1995]石子合并——题解/","从零开始使用Hexo的说明指南/","建系简单知识汇总/","丢弃Excel，Pandas一行搞定/","TinyDB-一个纯Python编写的轻量级数据库/","Python装饰器/","网站性能优化的一些小技巧/","Python-正则表达式一文通/","两万字长文让你彻底掌握-celery/","Python中的Deque-实现高效的队列和堆栈/","HarmonyOS 字体/","二次函数专题3/","二次函数专题2/","二次函数专题1/","压位-Trie-学习笔记/","ETT(Euler Tour Tree)学习笔记/","有限微积分与数列求和/","反比例函数/","毕氏树/","正弦定理/","共边定理/","记忆化搜索/","并查集/","三角形的内切圆/","唯一分解定理/","数学定理大全/","异或/","容斥原理/","线性筛/","乘法逆元/","树状数组/","倍增/","幂/","列表/","基本运算符/","集合/","zip-迭代/","海龟画图/","元组/","字典/","字符串/","初中数学知识点-角平分线/","初中数学知识点-等腰三角形/","初中数学知识点-等边三角形/","初中数学知识点-直角三角形/","初中数学知识点-等腰直角三角形/"];function toRandomPost(){ pjax.loadUrl('/'+posts[Math.floor(Math.random()*posts.length)]); }</script>